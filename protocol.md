# 串口协议

协议的数据来自于对现有 Windows 程序的分析。

- 接上串口后就可以接收消息  
- 一个消息应该有 74 Byte 长，以 0xFF, 0xFE 开头，以 0xAA 结束  
- 通道的顺序非常的混乱，下面在介绍是会以数据实际出现的顺序来表示，例如 4321， 意味着 Channel 4 的数据在前，Channel 1 的数据在最后面
- [2-5] 代表设备模式, 1： 充电，2: 放电，4: 刷新, 8: 容量测试, 16: 内阻测试。通道顺序为 4312
- [6] 代表四个通道的状态，高位 1 代表放电，低位 1 代表充电，00 代表没有数据。通道顺序为 2134
- [7] 高位代表完成，低位代表空。通道顺序为 4321
- [8] 如果 & 16 = true，则温度保护，低四位 为 true 这代表暂停。通道顺序为 2134
- [9:16] 两个 byte 代表通道设置电流，高位在后。通道顺序为 4312
- [17:24] 两个 byte 代表通道当前的电流，高位在后。通道顺序为 4312
- [25:32] 两个 byte 代表通道的离线电压，高位在后。通道顺序为 4312
- [33:40] 两个 byte 代表通道的电压，高位在后。通道顺序为 4312
- [41:56] 四个 byte 代表通道的毫安时数据，高位在后，高位在后。通道顺序为 4312
  不同的模式下毫安时数据意义不一样，在充电时为冲入电量，其余时间为放电电量  
- [57:64] 两个 byte 代表消耗的时间，高位在前。通道顺序为 4312
- [65:72] 两个 byte 代表内阻，高位在后。通道顺序为 4312
- 可以通过发送两个 byte 来启动暂停某个通道
   | 通道 | 启动 | 暂停 |
   | ---- | ---- | ---- |
   | A    | 0x10 | 0x01 |
   | B    | 0x20 | 0x02 |
   | C    | 0x40 | 0x04 |
   | D    | 0x80 | 0x08 |